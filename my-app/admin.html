<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>project design</title>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/fonts/ionicons.min.css">
    <link rel="stylesheet" href="assets/fonts/material-icons.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body style="background: #B3C799;">
    <div class="container-fluid">
        <div class="row">
            <div class="col-3 position-fixed top-0 bottom-0" style="background: #ebe3ce;width: 400px;">
                <div class="text-center align-items-center mx-auto" style="height: auto;width: auto;margin: 40px;"><img class="img-fluid mb-3" src="assets/img/log%20sky.png" style="width: 150px;margin-top: 15px;">
                    <p class="text-center" style="color: #28aa4a;font-size: 18px;font-weight: bold;">Sky Power Solution Co., Ltd.</p>
                </div>
                <div class="d-flex flex-column">
                    <ul class="nav nav-tabs flex-column mb-3" style="margin-left: 30px;margin-top: 50px;">
                        <li class="nav-item d-flex align-items-center active" style="height: 45px;margin-bottom: 20px;"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 20 20" fill="none" style="width: 24px;height: 24px;">

                                <path fill-rule="evenodd" clip-rule="evenodd" d="M10 9C11.6569 9 13 7.65685 13 6C13 4.34315 11.6569 3 10 3C8.34315 3 7 4.34315 7 6C7 7.65685 8.34315 9 10 9ZM3 18C3 14.134 6.13401 11 10 11C13.866 11 17 14.134 17 18H3Z" fill="currentColor"></path>
                            </svg><a class="nav-link" href="#" style="color: rgb(0,0,0);font-size: 20px;font-weight: bold;">User Management</a></li>
                        <li class="nav-item d-flex align-items-center active"><i class="material-icons">settings</i><a class="nav-link" href="#" style="color: rgb(0,0,0);font-size: 20px;font-weight: bold;">Setting</a></li>
                    </ul>
                </div>
                <div style="width: 350px;margin-left: 10px;"><a class="btn d-flex align-items-center align-content-center d-flex" role="button" style="text-align: justify;margin-top: 100px;font-size: 20px;font-weight: bold;color: #ca0000;border-right-style: none;background: rgba(240,192,64,0);margin-left: 5px;" href="login.html"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" class="d-flex justify-content-center align-items-center align-content-center me-2" style="width: 24px;height: 24px;text-align: justify;">
                            <path d="M13 4.00894C13.0002 3.45665 12.5527 3.00876 12.0004 3.00854C11.4481 3.00833 11.0002 3.45587 11 4.00815L10.9968 12.0116C10.9966 12.5639 11.4442 13.0118 11.9965 13.012C12.5487 13.0122 12.9966 12.5647 12.9968 12.0124L13 4.00894Z" fill="currentColor"></path>
                            <path d="M4 12.9917C4 10.7826 4.89541 8.7826 6.34308 7.33488L7.7573 8.7491C6.67155 9.83488 6 11.3349 6 12.9917C6 16.3054 8.68629 18.9917 12 18.9917C15.3137 18.9917 18 16.3054 18 12.9917C18 11.3348 17.3284 9.83482 16.2426 8.74903L17.6568 7.33481C19.1046 8.78253 20 10.7825 20 12.9917C20 17.41 16.4183 20.9917 12 20.9917C7.58172 20.9917 4 17.41 4 12.9917Z" fill="currentColor"></path>
                        </svg>Logout</a></div>
            </div>
            <div class="col-9 flex-grow-0">
                <div class="input-group" style="margin-left: 450px;width: auto;border-style: none;margin-top: 20px;"><button class="btn btn-primary btn-warning input-group" type="button" style="width: 50px;background: rgb(255,255,255);border: 2px solid rgb(0,0,0) ;border-right-style: none;border-right-color: rgb(255,255,255);"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 20 20" fill="none" class="input-group" style="background: #ffffff;color: rgb(0,0,0);border-top-left-radius: 5px;border-bottom-left-radius: 5px;">

                            <path fill-rule="evenodd" clip-rule="evenodd" d="M8 4C5.79086 4 4 5.79086 4 8C4 10.2091 5.79086 12 8 12C10.2091 12 12 10.2091 12 8C12 5.79086 10.2091 4 8 4ZM2 8C2 4.68629 4.68629 2 8 2C11.3137 2 14 4.68629 14 8C14 9.29583 13.5892 10.4957 12.8907 11.4765L17.7071 16.2929C18.0976 16.6834 18.0976 17.3166 17.7071 17.7071C17.3166 18.0976 16.6834 18.0976 16.2929 17.7071L11.4765 12.8907C10.4957 13.5892 9.29583 14 8 14C4.68629 14 2 11.3137 2 8Z" fill="currentColor"></path>
                        </svg></button>
                    <form class="align-items-center"><input class="form-control align-items-center input-group" type="text" style="width: 300px;height: 44px;border-radius: 0px;border-top-right-radius: 5px;border-bottom-right-radius: 5px;border: 2px solid rgb(0,0,0) ;border-left-style: none;border-left-color: rgb(255,255,255);" placeholder="Search..."></form>
                </div>
                <div class="row align-items-center w-100" style="margin-left: 450px;margin-top: 30px;margin-right: 0px;">
                    <div class="col" id="Products" style="padding: 0px;">
                        <h1 style="font-weight: bold;margin: 0px;">User Management</h1>
                    </div>
                    <div class="col-auto" style="margin-right: 0px;padding: 0px;padding-right: 40px;">
                        <button onclick="showadduser()" id = 'AddUser' class="btn btn-primary align-items-center me-2 d-flex" type="button" style="width: 160px;border-radius: 5px;background: #ebe3ce;color: rgb(0,0,0);font-weight: bold;border-style: solid;"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 20 20" fill="none" class="d-flex align-items-center me-2" style="width: 24px;height: 24px;">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M10 5C10.5523 5 11 5.44772 11 6V9L14 9C14.5523 9 15 9.44772 15 10C15 10.5523 14.5523 11 14 11H11V14C11 14.5523 10.5523 15 10 15C9.44771 15 9 14.5523 9 14V11H6C5.44772 11 5 10.5523 5 10C5 9.44771 5.44772 9 6 9L9 9V6C9 5.44772 9.44771 5 10 5Z" fill="currentColor"></path>
                        </svg>Add User</button></div>
                    </div>
                </div>
                <div id="content-box" style="padding: 10px; box-shadow: 0px 0px 10px; width: 1400px; background: #ffffff; margin: 200px; height: 675px; margin-left: 450px; margin-top: 5px; margin-bottom: 0px; border-radius: 10px;">
                    <div class="table-responsive" style="width: 1370px; margin-left: 10px; margin-top: 5px;">
                      <table class="table table-bordered">
                        <thead style="background: #d9d9d9;">
                          <tr>
                            <th class="text-center" style="width: 150px; font-size: 18px; font-weight: bold;">ID</th>
                            <th class="text-center" style="width: 150px; font-size: 18px; font-weight: bold;">Username</th>
                            <th class="text-center" style="width: 150px; font-size: 18px; font-weight: bold;">Role</th>
                            <th class="text-center" style="width: 150px; font-size: 18px; font-weight: bold;">Email</th>
                            <th class="text-center" style="width: 150px; font-size: 18px; font-weight: bold;">Status</th>
                            <th class="text-center" style="width: 150px; font-size: 18px; font-weight: bold;">Updated At</th>
                            <th class="text-center" style="width: 150px; font-size: 18px; font-weight: bold;">Created At</th>
                            <th class="text-center" style="width: 100px; font-size: 18px; font-weight: bold;">Actions</th>
                          </tr>
                        </thead>
                        <tbody>
                          <!-- Rows will be dynamically inserted here -->
                        </tbody>
                      </table>
                    </div>
                  </div>
                  
                  <!-- Pagination Below Content Box -->
                  <nav class="pagination-rounded d-flex justify-content-center mt-4" style="margin-left: 200px;">
                    <ul class="pagination">
                      <!-- Pagination buttons will be dynamically inserted here -->
                    </ul>
                  </nav>
                  
        </div>
    </div>

    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        window.onload = async function() {
            const token = localStorage.getItem("token");
        console.log('my-token:', token);
    
        // ตรวจสอบว่า token มีค่าอยู่หรือไม่
        if (!token) {
            alert("กรุณาล็อกอินก่อน");
            window.location.href = '/index.html';  // ถ้าไม่มี token ให้ redirect ไปหน้า login
            return;
        }
            try {
            // ส่งคำขอ GET ไปที่เซิร์ฟเวอร์เพื่อเช็ค role
            const response = await fetch('http://localhost:5000/api/users/role_check', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,  // ส่ง token เป็น Bearer token
                    'Content-Type': 'application/json',
                },
            });
    
            if (!response.ok) {
                console.error('Error response:', errorData);
                window.location.href = '/index.html'; // ถ้ามีข้อผิดพลาดจาก API จะพาไปหน้า login
                return;
            }
    
            const data = await response.json();
            console.log("User data:", data);
    
            if (data.error) {
                alert(data.error || 'เกิดข้อผิดพลาดในการตรวจสอบข้อมูลผู้ใช้');
                window.location.href = '/showDash.html';
                return;
            }
    
            // ✅ ตรวจสอบ role และทำการ redirect
            if (data.role !== "Admin") {
                window.location.href = '/showDash.html';
            }
        } catch (error) {
            console.error('Network error or fetch issue:', error);
            alert("เกิดข้อผิดพลาดในการเชื่อมต่อเซิร์ฟเวอร์");
        }
        };
    </script>  
    <script src="assets/js/adduser.js"></script> 
    <script src="assets/js/style.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>

</html>